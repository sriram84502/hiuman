<VirtualHost *:80>
    DocumentRoot /var/www/html
    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    # Proxy WebSocket to Node.js (Robust Config)
    ProxyPreserveHost On
    ProxyPass /socket.io http://127.0.0.1:3001/socket.io upgrade=websocket
    ProxyPassReverse /socket.io http://127.0.0.1:3001/socket.io
    
    # 3. Exclude /api request from SPA rewrite (let api/.htaccess handle them)
    RewriteCond %{REQUEST_URI} ^/api
    RewriteRule ^ - [L]

    # 4. Exclude /assets from SPA rewrite (Serve statically or 404)
    RewriteCond %{REQUEST_URI} ^/assets
    RewriteRule ^ - [L]

    # 5. SPA Fallback: If not file/dir, go to index.html
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^.*$ /index.html [L]
</VirtualHost>
